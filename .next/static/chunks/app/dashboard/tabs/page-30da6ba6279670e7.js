(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[486],{477:(e,t,a)=>{"use strict";a.d(t,{U:()=>c,s:()=>l});var s=a(5155),r=a(722),n=a(2115);let i=(0,n.createContext)(void 0),l=e=>{let{children:t}=e,[a,l]=(0,n.useState)([]),[c,d]=(0,n.useState)({dailyRevenue:0,totalOrdersToday:0,averageOrderValueToday:0}),[o,m]=(0,n.useState)(!0),[u,h]=(0,n.useState)(null),x=(0,n.useCallback)(async()=>{try{m(!0),h(null);let e=(await r.sn.getAll({limit:100})).map(e=>{var t;return{id:e.id,timestamp:new Date(e.timestamp),items:(null===(t=e.items)||void 0===t?void 0:t.map(e=>({menuItem:{id:e.menu_item.id,name:e.menu_item.name,price:e.unit_price,category:e.menu_item.category},quantity:e.quantity,get totalPrice(){return this.menuItem.price*this.quantity}})))||[],totalAmount:e.total_amount,annotationId:e.annotation_id,paymentMethod:e.payment_method}});l(e)}catch(e){h(e instanceof Error?e.message:"Erro ao carregar transa\xe7\xf5es"),console.error("Erro ao carregar transa\xe7\xf5es:",e)}finally{m(!1)}},[]),p=(0,n.useCallback)(async()=>{try{let e=await r.sn.getDailyStats();d({dailyRevenue:e.total_revenue,totalOrdersToday:e.total_orders,averageOrderValueToday:e.average_order_value})}catch(e){console.error("Erro ao carregar estat\xedsticas di\xe1rias:",e)}},[]),f=(0,n.useCallback)(async e=>{try{h(null);let t={items:e.items.map(e=>({menu_item_id:e.menuItem.id,quantity:e.quantity,unit_price:e.menuItem.price})),total_amount:e.totalAmount,payment_method:e.paymentMethod,annotation_id:e.annotationId},a=await r.sn.create(t),s={id:a.id,timestamp:new Date(a.timestamp),items:e.items,totalAmount:e.totalAmount,annotationId:e.annotationId,paymentMethod:e.paymentMethod};l(e=>[s,...e]),await p()}catch(e){throw h(e instanceof Error?e.message:"Erro ao criar transa\xe7\xe3o"),e}},[p]);return(0,n.useEffect)(()=>{Promise.all([x(),p()])},[x,p]),(0,s.jsx)(i.Provider,{value:{transactions:a,addTransaction:f,dailyRevenue:c.dailyRevenue,totalOrdersToday:c.totalOrdersToday,averageOrderValueToday:c.averageOrderValueToday,loading:o,error:u,refreshTransactions:x,refreshDailyStats:p},children:t})},c=()=>{let e=(0,n.useContext)(i);if(!e)throw Error("useSales must be used within a SalesProvider");return e}},799:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>v});var s=a(5155),r=a(2115),n=a(285),i=a(6695),l=a(6424),c=a(2346),d=a(4165),o=a(2523),m=a(5057),u=a(3933),h=a(4301),x=a(7481);function p(){let[e,t]=(0,r.useState)(""),[a,i]=(0,r.useState)(!1),{addTab:l}=(0,u.u)(),{toast:c}=(0,x.dj)();return(0,s.jsxs)(d.lG,{open:a,onOpenChange:i,children:[(0,s.jsx)(d.zM,{asChild:!0,children:(0,s.jsxs)(n.$,{children:[(0,s.jsx)(h.A,{className:"mr-2 h-4 w-4"}),"Nova Aba"]})}),(0,s.jsxs)(d.Cf,{className:"sm:max-w-[425px]",children:[(0,s.jsxs)(d.c7,{children:[(0,s.jsx)(d.L3,{children:"Criar Nova Aba"}),(0,s.jsx)(d.rr,{children:"Insira um nome para a nova aba (ex: Mesa 5, Cliente Ana)."})]}),(0,s.jsx)("div",{className:"grid gap-4 py-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(m.J,{htmlFor:"tab-name",className:"text-right",children:"Nome"}),(0,s.jsx)(o.p,{id:"tab-name",value:e,onChange:e=>t(e.target.value),className:"col-span-3",placeholder:"Nome da Aba"})]})}),(0,s.jsxs)(d.Es,{children:[(0,s.jsx)(n.$,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancelar"}),(0,s.jsx)(n.$,{type:"submit",onClick:()=>{if(""===e.trim()){c({title:"Erro",description:"O nome da aba n\xe3o pode estar vazio.",variant:"destructive"});return}l(e.trim()),c({title:"Sucesso",description:'Aba "'.concat(e.trim(),'" criada.')}),t(""),i(!1)},children:"Criar Aba"})]})]})]})}var f=a(9409),j=a(1978);function y(e){let{tab:t,isOpen:a,onOpenChange:i}=e,[l,c]=(0,r.useState)(void 0),[h,p]=(0,r.useState)(1),{addItemToTab:y}=(0,u.u)(),{menuItems:g}=(0,j.b)(),{toast:b}=(0,x.dj)();return(0,s.jsx)(d.lG,{open:a,onOpenChange:i,children:(0,s.jsxs)(d.Cf,{className:"sm:max-w-[425px]",children:[(0,s.jsxs)(d.c7,{children:[(0,s.jsxs)(d.L3,{children:["Adicionar Item \xe0 Aba: ",t.name]}),(0,s.jsx)(d.rr,{children:"Selecione um item e a quantidade para adicionar \xe0 aba."})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(m.J,{htmlFor:"menu-item",className:"text-right",children:"Item"}),(0,s.jsxs)(f.l6,{value:l,onValueChange:c,children:[(0,s.jsx)(f.bq,{className:"col-span-3",children:(0,s.jsx)(f.yv,{placeholder:"Selecione um item"})}),(0,s.jsx)(f.gC,{children:g.map(e=>(0,s.jsxs)(f.eb,{value:e.id,children:[e.name," - ",e.price.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]},e.id))})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(m.J,{htmlFor:"quantity",className:"text-right",children:"Quantidade"}),(0,s.jsx)(o.p,{id:"quantity",type:"number",value:h,onChange:e=>p(parseInt(e.target.value,10)||1),className:"col-span-3",min:"1"})]})]}),(0,s.jsxs)(d.Es,{children:[(0,s.jsx)(n.$,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancelar"}),(0,s.jsx)(n.$,{type:"submit",onClick:()=>{if(!l||h<=0){b({title:"Erro",description:"Selecione um item e insira uma quantidade v\xe1lida.",variant:"destructive"});return}let e=g.find(e=>e.id===l);e&&(y(t.id,e,h),b({title:"Item Adicionado",description:"".concat(h,"x ").concat(e.name,' adicionado(s) \xe0 aba "').concat(t.name,'".')}),c(void 0),p(1),i(!1))},children:"Adicionar Item"})]})]})})}var g=a(8046),b=a(8390),N=a(10);function v(){let{tabs:e,closeTab:t}=(0,u.u)(),[a,d]=(0,r.useState)(null),{toast:o}=(0,x.dj)(),m=e.filter(e=>"open"===e.status),h=e.filter(e=>"open"!==e.status),f=e=>{t(e,"Dinheiro"),o({title:"Aba Fechada",description:"Aba #".concat(e.substring(0,6)," foi fechada e o pagamento registrado.")})};return(0,s.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,s.jsxs)("header",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-headline font-semibold",children:"Gest\xe3o de Abas"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Crie, gerencie e feche as abas dos clientes."})]}),(0,s.jsx)(p,{})]}),(0,s.jsxs)("section",{children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold mb-3",children:["Abas Abertas (",m.length,")"]}),0===m.length?(0,s.jsx)("p",{className:"text-muted-foreground",children:"Nenhuma aba aberta no momento."}):(0,s.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:m.map(e=>(0,s.jsxs)(i.Zp,{className:"flex flex-col",children:[(0,s.jsxs)(i.aR,{children:[(0,s.jsxs)(i.ZB,{className:"flex items-center justify-between",children:[e.name,(0,s.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat("open"===e.status?"bg-green-100 text-green-700":"paid"===e.status?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:"open"===e.status?"Aberta":"paid"===e.status?"Paga":"Fechada"})]}),(0,s.jsxs)(i.BT,{children:["Criada em: ",new Date(e.createdAt).toLocaleDateString("pt-BR")]})]}),(0,s.jsxs)(i.Wu,{className:"flex-grow",children:[(0,s.jsx)(l.F,{className:"h-32",children:0===e.items.length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Nenhum item adicionado."}):(0,s.jsx)("ul",{className:"space-y-1 text-sm",children:e.items.map((e,t)=>(0,s.jsxs)("li",{className:"flex justify-between",children:[(0,s.jsxs)("span",{children:[e.quantity,"x ",e.menuItem.name]}),(0,s.jsx)("span",{children:e.totalPrice.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]},t))})}),(0,s.jsx)(c.w,{className:"my-2"}),(0,s.jsxs)("div",{className:"flex justify-between font-semibold",children:[(0,s.jsx)("span",{children:"Total:"}),(0,s.jsx)("span",{children:e.totalAmount.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]})]}),(0,s.jsxs)(i.wL,{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>d(e),children:[(0,s.jsx)(g.A,{className:"mr-2 h-4 w-4"})," Adicionar Item"]}),(0,s.jsxs)(N.Lt,{children:[(0,s.jsx)(N.tv,{asChild:!0,children:(0,s.jsxs)(n.$,{variant:"destructive",size:"sm",disabled:0===e.items.length,children:[(0,s.jsx)(b.A,{className:"mr-2 h-4 w-4"})," Fechar Conta"]})}),(0,s.jsxs)(N.EO,{children:[(0,s.jsxs)(N.wd,{children:[(0,s.jsx)(N.r7,{children:"Confirmar Fechamento da Aba?"}),(0,s.jsxs)(N.$v,{children:["Aba: ",e.name," ",(0,s.jsx)("br",{}),"Total: ",e.totalAmount.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})," ",(0,s.jsx)("br",{}),"Esta a\xe7\xe3o ir\xe1 registrar a venda e marcar a aba como paga. Deseja continuar?"]})]}),(0,s.jsxs)(N.ck,{children:[(0,s.jsx)(N.Zr,{children:"Cancelar"}),(0,s.jsx)(N.Rx,{onClick:()=>f(e.id),children:"Confirmar Pagamento"})]})]})]})]})]},e.id))})]}),a&&(0,s.jsx)(y,{tab:a,isOpen:!!a,onOpenChange:e=>{e||d(null)}}),h.length>0&&(0,s.jsxs)("section",{className:"mt-8",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold mb-3",children:["Abas Fechadas/Pagas (",h.length,")"]}),(0,s.jsx)(l.F,{className:"h-64",children:(0,s.jsx)("div",{className:"space-y-3",children:h.map(e=>(0,s.jsx)(i.Zp,{className:"opacity-70",children:(0,s.jsxs)(i.aR,{className:"pb-2",children:[(0,s.jsxs)(i.ZB,{className:"text-base flex items-center justify-between",children:[e.name,(0,s.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat("paid"===e.status?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:"paid"===e.status?"Paga":"Fechada"})]}),(0,s.jsxs)(i.BT,{className:"text-xs",children:["Fechada em: ",new Date(e.createdAt).toLocaleDateString("pt-BR")," - Total: ",e.totalAmount.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]})]})},e.id))})})]})]})}},1978:(e,t,a)=>{"use strict";a.d(t,{B:()=>l,b:()=>c});var s=a(5155),r=a(722),n=a(2115);let i=(0,n.createContext)(void 0),l=e=>{let{children:t}=e,[a,l]=(0,n.useState)([]),[c,d]=(0,n.useState)(!0),[o,m]=(0,n.useState)(null),u=(0,n.useCallback)(async()=>{try{d(!0),m(null);let e=await r.Y_.getAll();l(e)}catch(e){m(e instanceof Error?e.message:"Erro ao carregar itens do menu"),console.error("Erro ao carregar itens do menu:",e)}finally{d(!1)}},[]),h=(0,n.useCallback)(async e=>{try{m(null);let t=await r.Y_.create(e);l(e=>[...e,t])}catch(e){throw m(e instanceof Error?e.message:"Erro ao criar item do menu"),e}},[]),x=(0,n.useCallback)(async e=>{try{m(null),await r.Y_.delete(e),l(t=>t.filter(t=>t.id!==e))}catch(e){throw m(e instanceof Error?e.message:"Erro ao remover item do menu"),e}},[]);return(0,n.useEffect)(()=>{u()},[u]),(0,s.jsx)(i.Provider,{value:{menuItems:a,addMenuItem:h,removeMenuItem:x,loading:c,error:o,refreshMenuItems:u},children:t})},c=()=>{let e=(0,n.useContext)(i);if(!e)throw Error("useMenu must be used within a MenuProvider");return e}},2346:(e,t,a)=>{"use strict";a.d(t,{w:()=>l});var s=a(5155),r=a(2115),n=a(7489),i=a(9434);let l=r.forwardRef((e,t)=>{let{className:a,orientation:r="horizontal",decorative:l=!0,...c}=e;return(0,s.jsx)(n.b,{ref:t,decorative:l,orientation:r,className:(0,i.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",a),...c})});l.displayName=n.b.displayName},3717:(e,t,a)=>{"use strict";a.d(t,{LN:()=>s,Le:()=>r,bT:()=>n});class s{get totalPrice(){return this.menuItem.price*this.quantity}constructor(e,t){this.menuItem=e,this.quantity=t}}class r{get totalAmount(){return this.items.reduce((e,t)=>e+t.totalPrice,0)}constructor(e,t,a){this.id=e,this.customerId=t,this.customerName=a,this.items=[],this.status="open",this.createdAt=new Date}}class n{get totalAmount(){return this.items.reduce((e,t)=>e+t.totalPrice,0)}constructor(e,t){this.id=e,this.name=t,this.items=[],this.createdAt=new Date,this.status="open"}}},3933:(e,t,a)=>{"use strict";a.d(t,{O:()=>c,u:()=>d});var s=a(5155),r=a(3717),n=a(2115),i=a(477);let l=(0,n.createContext)(void 0),c=e=>{let{children:t}=e,[a,c]=(0,n.useState)([]),{addTransaction:d}=(0,i.U)(),o=(0,n.useCallback)(e=>{let t=new r.bT("tab-".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,7)),e);return c(e=>[...e,t]),t},[]),m=(0,n.useCallback)((e,t,a)=>{c(s=>s.map(s=>{if(s.id===e&&"open"===s.status){let e;let n=s.items.findIndex(e=>e.menuItem.id===t.id);e=n>-1?s.items.map((e,s)=>s===n?new r.LN(t,e.quantity+a):e):[...s.items,new r.LN(t,a)];let i=new r.bT(s.id,s.name);return i.items=e,i.status=s.status,i.createdAt=s.createdAt,i}return s}))},[]),u=(0,n.useCallback)((e,t)=>{let s=a.find(t=>t.id===e);s&&"open"===s.status&&(d({items:s.items,totalAmount:s.totalAmount,tabId:s.id,paymentMethod:t}),c(t=>t.map(t=>t.id===e?{...t,status:"paid"}:t)))},[a,d]),h=(0,n.useCallback)(e=>a.find(t=>t.id===e),[a]);return(0,s.jsx)(l.Provider,{value:{tabs:a,addTab:o,addItemToTab:m,closeTab:u,getTabById:h},children:t})},d=()=>{let e=(0,n.useContext)(l);if(!e)throw Error("useTabs must be used within a TabsProvider");return e}},4363:(e,t,a)=>{Promise.resolve().then(a.bind(a,799))},6424:(e,t,a)=>{"use strict";a.d(t,{F:()=>l});var s=a(5155),r=a(2115),n=a(7655),i=a(9434);let l=r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,s.jsxs)(n.bL,{ref:t,className:(0,i.cn)("relative overflow-hidden",a),...l,children:[(0,s.jsx)(n.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,s.jsx)(c,{}),(0,s.jsx)(n.OK,{})]})});l.displayName=n.bL.displayName;let c=r.forwardRef((e,t)=>{let{className:a,orientation:r="vertical",...l}=e;return(0,s.jsx)(n.VM,{ref:t,orientation:r,className:(0,i.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...l,children:(0,s.jsx)(n.lr,{className:"relative flex-1 rounded-full bg-border"})})});c.displayName=n.VM.displayName},8046:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(157).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},9409:(e,t,a)=>{"use strict";a.d(t,{bq:()=>u,eb:()=>f,gC:()=>p,l6:()=>o,yv:()=>m});var s=a(5155),r=a(2115),n=a(83),i=a(9556),l=a(7381),c=a(518),d=a(9434);let o=n.bL;n.YJ;let m=n.WT,u=r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,s.jsxs)(n.l9,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...l,children:[r,(0,s.jsx)(n.In,{asChild:!0,children:(0,s.jsx)(i.A,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=n.l9.displayName;let h=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.PP,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,s.jsx)(l.A,{className:"h-4 w-4"})})});h.displayName=n.PP.displayName;let x=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.wn,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,s.jsx)(i.A,{className:"h-4 w-4"})})});x.displayName=n.wn.displayName;let p=r.forwardRef((e,t)=>{let{className:a,children:r,position:i="popper",...l}=e;return(0,s.jsx)(n.ZL,{children:(0,s.jsxs)(n.UC,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:i,...l,children:[(0,s.jsx)(h,{}),(0,s.jsx)(n.LM,{className:(0,d.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,s.jsx)(x,{})]})})});p.displayName=n.UC.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.JU,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...r})}).displayName=n.JU.displayName;let f=r.forwardRef((e,t)=>{let{className:a,children:r,...i}=e;return(0,s.jsxs)(n.q7,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...i,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(n.VF,{children:(0,s.jsx)(c.A,{className:"h-4 w-4"})})}),(0,s.jsx)(n.p4,{children:r})]})});f.displayName=n.q7.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.wv,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=n.wv.displayName}},e=>{var t=t=>e(e.s=t);e.O(0,[277,568,756,122,655,539,512,619,441,684,358],()=>t(4363)),_N_E=e.O()}]);